jQuery(function($){var $commentsWrap;if("object"==typeof localforage&&$("#comments").length){var displaySetting="",piedCommenters=[],imageCount=commentFilterVars.images.length,quoteCount=commentFilterVars.quotes.length,imageIndex=0,quoteIndex=0,$commenterContent=$("#cf-commenter-content"),$piedContent=$("#cf-pied-content"),$settingsForm=$("#cf-settings-form"),commentUpIcon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 40" x="0px" y="0px" height="2em" width="2em" fill="currentColor"><title>comment-up</title><g data-name="comment-up"><path d="M28,3H4A2,2,0,0,0,2,5V23a2,2,0,0,0,2,2H6v3a1,1,0,0,0,.57.9A.91.91,0,0,0,7,29a1,1,0,0,0,.62-.22L12.35,25H28a2,2,0,0,0,2-2V5A2,2,0,0,0,28,3Zm0,20H12a1,1,0,0,0-.62.22L8,25.92V24a1,1,0,0,0-1-1H4V5H28Z"/><path d="M12.71,14.71,15,12.41V18a1,1,0,0,0,2,0V12.41l2.29,2.3a1,1,0,0,0,1.42,0,1,1,0,0,0,0-1.42l-4-4a1,1,0,0,0-.33-.21,1,1,0,0,0-.76,0,1,1,0,0,0-.33.21l-4,4a1,1,0,0,0,1.42,1.42Z"/></g></svg>',commentDownIcon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 40" x="0px" y="0px" height="2em" width="2em" fill="currentColor"><title>comment-down</title><g data-name="comment-down"><path d="M28,3H4A2,2,0,0,0,2,5V23a2,2,0,0,0,2,2H6v3a1,1,0,0,0,.57.9A.91.91,0,0,0,7,29a1,1,0,0,0,.62-.22L12.35,25H28a2,2,0,0,0,2-2V5A2,2,0,0,0,28,3Zm0,20H12a1,1,0,0,0-.62.22L8,25.92V24a1,1,0,0,0-1-1H4V5H28Z"/><path d="M15.29,18.71a1,1,0,0,0,.33.21.94.94,0,0,0,.76,0,1,1,0,0,0,.33-.21l4-4a1,1,0,0,0-1.42-1.42L17,15.59V10a1,1,0,0,0-2,0v5.59l-2.29-2.3a1,1,0,0,0-1.42,1.42Z"/></g></svg>';localforage.getItem("commentFilterDisplay").then(function(value){value?(displaySetting=value,$settingsForm.find('input[name="cf-display"][value="'+displaySetting+'"]').prop("checked",!0)):(displaySetting=$settingsForm.find('input[name="cf-display"]:checked').val(),localforage.setItem("commentFilterDisplay",displaySetting))}),$settingsForm.on("change",'[name="cf-display"]',function(e){displaySetting=this.value,localforage.setItem("commentFilterDisplay",displaySetting);var $cfContent=$(".cf-content");$cfContent.length&&$.each($cfContent,function(index,value){doCommentContent($(this))})}),localforage.getItem("piedCommenters").then(function(value){piedCommenters=value||piedCommenters;var commenterList=new List("cf-commenter-content",{valueNames:["cf-commenter"]}),piedList=new List("cf-pied-content",{valueNames:["cf-commenter"]});if(commenterList.remove("cf-commenter",""),piedList.remove("cf-commenter",""),piedCommenters&&piedCommenters.length)for(var i=0;i<piedCommenters.length;i++)commenterList.remove("cf-commenter",piedCommenters[i]),piedList.add({"cf-commenter":piedCommenters[i]}),hideComments(piedCommenters[i]);function filterThisCommenter(commenter){piedCommenters.push(commenter),piedCommenters=piedCommenters.filter(makeUnique),localforage.setItem("piedCommenters",piedCommenters),piedList.add({"cf-commenter":commenter}),commenterList.remove("cf-commenter",commenter),hideComments(commenter),doEmptyLists()}function unfilterThisCommenter(commenter){var index=piedCommenters.indexOf(commenter),$inner;-1!==index&&(piedCommenters.splice(index,1),localforage.setItem("piedCommenters",piedCommenters),piedList.remove("cf-commenter",commenter),$('.cf-comment-inner[data-name="'+commenter+'"]').length&&commenterList.add({"cf-commenter":commenter}),showComments(commenter),doEmptyLists())}function hideComments(commenter){var $comment=getComment(commenter);$comment.length&&(hideComment($comment),hideReplies($comment))}function hideReplies($comment){$replies=getReplies($comment),$replies.length&&hideComment($replies)}function hideComment($comment){$.each($comment,function(index,value){var $commentLi=$(this).parents(".comment");if(!$(this).hasClass("cf-hidden")){$(this).parents(".comment").addClass("cf-hidden");var $toggle=$(this).find(".cf-toggle");$toggle.length||($toggle=$('<button role="button" class="comment-reply-link cf-toggle">Toggle</button>'),$(this).find(".comment-reply").append($toggle));var $cfContent=$(this).find(".cf-content");$cfContent.length||($cfContent=$('<div class="comment-content cf-content"></div>'),$(this).find(".comment-content").after($cfContent)),$cfContent.length&&doCommentContent($cfContent)}})}function showComments(commenter){var $comment=getComment(commenter);$comment.length&&(showComment($comment),showReplies($comment,commenter))}function showReplies($comment){if($replies=getReplies($comment),$replies.length){var commenter=$replies.data("name"),index;commenter=getEscaped(commenter),-1===piedCommenters.indexOf(commenter)&&showComment($replies)}}function showComment($comment){var $commentLi=$comment.parent(".comment"),$cfContent=$commentLi.find(".cf-content"),$toggle=$commentLi.find(".cf-toggle");$commentLi.length&&$commentLi.removeClass("cf-hidden cf-hidden-visible"),$cfContent.length&&$cfContent.remove(),$toggle.length&&$toggle.remove()}function getComment(commenter){var $comment=$('.cf-comment-inner[data-name="'+commenter+'"]');return $comment.length?$comment:{}}function getCommentContent($comment){var $content=$comment.find(".comment-content");return $content.length?$content:{}}function getReplies($comment){var id=$comment.data("id");return id?($replies=$('.cf-comment-inner[data-parent="'+id+'"]'),$replies.length?$replies:{}):{}}function doEmptyLists(){bool(commenterList.visibleItems.length&&$commenterContent.hasClass("cf-no-commenters"))?$commenterContent.removeClass("cf-no-commenters"):bool(commenterList.visibleItems.length)||bool($commenterContent.hasClass("cf-no-commenters"))||$commenterContent.addClass("cf-no-commenters"),bool(piedList.visibleItems.length&&$piedContent.hasClass("cf-no-commenters"))?$piedContent.removeClass("cf-no-commenters"):bool(piedList.visibleItems.length)||bool($piedContent.hasClass("cf-no-commenters"))||$piedContent.addClass("cf-no-commenters")}doEmptyLists(),$(".cf-list").on("click",".cf-button",function(e){var commenter=$(this).children(".cf-commenter").html();(commenter=getEscaped(commenter)).length&&($(this).hasClass("cf-add")?filterThisCommenter(commenter):$(this).hasClass("cf-remove")&&unfilterThisCommenter(commenter))}),$(".comment").on("click",".cf-toggle",function(e){var $commentLi=$(this).closest(".comment");$commentLi.length&&$commentLi.toggleClass("cf-hidden-visible")})})}function doCommentContent($cfContent){$.each($cfContent,function(index,value){switch(displaySetting){case"image":imageIndex===imageCount&&(imageIndex=0),$cfContent.html("<p>"+commentFilterVars.images[imageIndex]+"</p>"),imageIndex++;break;case"quote":quoteIndex===quoteCount&&(quoteIndex=0),console.log(quoteIndex),$cfContent.html("<p>"+commentFilterVars.quotes[quoteIndex]+"</p>"),quoteIndex++;break;default:$cfContent.html("")}})}function getEscaped(string){var div=document.createElement("div");return div.appendChild(document.createTextNode(string)),div.innerHTML}function makeUnique(value,index,self){return self.indexOf(value)===index}function bool(v){return"false"!==v&&"null"!==v&&"NaN"!==v&&"undefined"!==v&&"0"!==v&&!!v}});