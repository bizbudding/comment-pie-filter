jQuery((function($){if("object"==typeof localforage){var displaySetting="",filteredCommenters=[],imageCount=commentFilterVars.images.length,quoteCount=commentFilterVars.quotes.length,imageIndex=0,quoteIndex=0,$commentsWrap=$("#comments"),$respondWrap=$("#respond"),$commenterList=$("#jetsCommenterList"),$filteredList=$("#jetsFilteredList"),$commenterContent=$("#cf-commenter-content"),$filteredContent=$("#cf-filtered-content"),$settingsForm=$("#cf-settings-form");($commentsWrap.length||$respondWrap.length)&&(localforage.getItem("commentFilterDisplay").then((function(value){value?(displaySetting=value,$settingsForm.find('input[name="cf-display"][value="'+displaySetting+'"]').prop("checked",!0)):(displaySetting=$settingsForm.find('input[name="cf-display"]:checked').val(),localforage.setItem("commentFilterDisplay",displaySetting))})),$settingsForm.on("change",'[name="cf-display"]',(function(e){displaySetting=this.value,localforage.setItem("commentFilterDisplay",displaySetting);var $cfContent=$(".cf-content");$cfContent.length&&$.each($cfContent,(function(index,value){doCommentContent($(this))}))})),localforage.getItem("filteredCommenters").then((function(value){filteredCommenters=value||filteredCommenters;var commenterList=new Jets({searchTag:"#jetsCommenterSearch",contentTag:"#jetsCommenterList"}),filteredList=new Jets({searchTag:"#jetsFilteredSearch",contentTag:"#jetsFilteredList"});if(filteredCommenters&&filteredCommenters.length)for(var i=0;i<filteredCommenters.length;i++)filterThisCommenter(filteredCommenters[i]);function filterThisCommenter(commenter){filteredCommenters.push(commenter),filteredCommenters=filteredCommenters.filter(makeUnique),localforage.setItem("filteredCommenters",filteredCommenters),$filteredList.append('<li class="cf-list-item cf-commenter-item cfRemove" data-action="'+commentFilterVars.textRemove+'">'+commenter+"</li>"),$commenterList.find('li[data-jets="'+commenter.toLowerCase()+'"]').remove(),filteredList.update(),commenterList.update(),hideCommentsAndReplies(commenter),doEmptyLists()}function unfilterThisCommenter(commenter){var index=filteredCommenters.indexOf(commenter),$inner;-1!==index&&(filteredCommenters.splice(index,1),localforage.setItem("filteredCommenters",filteredCommenters),$filteredList.find('li[data-jets="'+commenter.toLowerCase()+'"]').remove(),$('.cf-comment-inner[data-name="'+commenter+'"]').length&&$commenterList.append('<li class="cf-list-item cf-commenter-item cfAdd" data-action="'+commentFilterVars.textAdd+'">'+commenter+"</li>"),filteredList.update(),commenterList.update(),showCommentsAndReplies(commenter),doEmptyLists())}function hideCommentsAndReplies(commenter){var $comments=getComments(commenter);$comments.length&&(hideComments($comments),$.each($comments,(function(index,value){hideReplies($(this))})))}function hideComments($comment){$.each($comment,(function(index,value){if(!$(this).hasClass("cf-hidden")){$(this).parents(".comment").addClass("cf-hidden");var $toggle=$(this).find(".cf-toggle");$toggle.length||($toggle=$('<button role="button" class="comment-reply-link cf-toggle">Toggle</button>'),$(this).find(".comment-reply").append($toggle));var $cfContent=$(this).find(".cf-content");$cfContent.length||($cfContent=$('<div class="comment-content cf-content"></div>'),$(this).find(".comment-content").after($cfContent)),$cfContent.length&&doCommentContent($cfContent)}}))}function hideReplies($comment){$replies=getReplies($comment),$replies.length&&hideComments($replies)}function showCommentsAndReplies(commenter){var $comments=getComments(commenter);$comments.length&&(showComments($comments),$.each($comments,(function(index,value){showReplies($(this))})))}function showReplies($comment){if($replies=getReplies($comment),$replies.length){var commenter=$replies.data("name"),index;-1===filteredCommenters.indexOf(commenter)&&showComments($replies)}}function showComments($comments){var $commentLi=$comments.parent(".comment"),$cfContent=$commentLi.find(".cf-content"),$toggle=$commentLi.find(".cf-toggle");$commentLi.length&&$commentLi.removeClass("cf-hidden cf-hidden-visible"),$cfContent.length&&$cfContent.remove(),$toggle.length&&$toggle.remove()}function getComments(commenter){var $comments=$('.cf-comment-inner[data-name="'+commenter+'"]');return $comments.length?$comments:{}}function getCommentsContent($comments){var $contents=$comments.find(".comment-content");return $contents.length?$contents:{}}function getReplies($comment){var id=$comment.data("id");return id?($replies=$('.cf-comment-inner[data-parent="'+id+'"]'),$replies.length?$replies:{}):{}}function doEmptyLists(){var commenterItems=$commenterList.find("li").length,filteredItems=$filteredList.find("li").length;bool(commenterItems&&$commenterContent.hasClass("cf-no-commenters"))?$commenterContent.removeClass("cf-no-commenters"):bool(commenterItems)||bool($commenterContent.hasClass("cf-no-commenters"))||$commenterContent.addClass("cf-no-commenters"),bool(filteredItems&&$filteredContent.hasClass("cf-no-commenters"))?$filteredContent.removeClass("cf-no-commenters"):bool(filteredItems)||bool($filteredContent.hasClass("cf-no-commenters"))||$filteredContent.addClass("cf-no-commenters")}doEmptyLists(),$(".cf-list").on("click",".cf-list-item",(function(e){var commenter=$(this).text();commenter.length&&($(this).hasClass("cfAdd")?filterThisCommenter(commenter):$(this).hasClass("cfRemove")&&unfilterThisCommenter(commenter))})),$(".comment").on("click",".cf-toggle",(function(e){var $commentLi=$(this).closest(".comment");$commentLi.length&&$commentLi.toggleClass("cf-hidden-visible")}))})))}function doCommentContent($cfContent){$.each($cfContent,(function(index,value){switch(displaySetting){case"image":imageIndex===imageCount&&(imageIndex=0),$cfContent.html("<p>"+commentFilterVars.images[imageIndex]+"</p>"),imageIndex++;break;case"quote":quoteIndex===quoteCount&&(quoteIndex=0),$cfContent.html("<p>"+commentFilterVars.quotes[quoteIndex]+"</p>"),quoteIndex++;break;default:$cfContent.html("")}}))}function makeUnique(value,index,self){return self.indexOf(value)===index}function bool(v){return"false"!==v&&"null"!==v&&"NaN"!==v&&"undefined"!==v&&"0"!==v&&!!v}}));