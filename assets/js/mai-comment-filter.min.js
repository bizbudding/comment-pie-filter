jQuery(function($){if("object"==typeof localforage){var displaySetting="",filteredCommenters=[],imageCount=commentFilterVars.images.length,quoteCount=commentFilterVars.quotes.length,imageIndex=0,quoteIndex=0,$commentsWrap=$("#comments"),$respondWrap=$("#respond"),$commenterContent=$("#cf-commenter-content"),$filteredContent=$("#cf-filtered-content"),$settingsForm=$("#cf-settings-form");($commentsWrap.length||$respondWrap.length)&&(localforage.getItem("commentFilterDisplay").then(function(value){value?(displaySetting=value,$settingsForm.find('input[name="cf-display"][value="'+displaySetting+'"]').prop("checked",!0)):(displaySetting=$settingsForm.find('input[name="cf-display"]:checked').val(),localforage.setItem("commentFilterDisplay",displaySetting))}),$settingsForm.on("change",'[name="cf-display"]',function(e){displaySetting=this.value,localforage.setItem("commentFilterDisplay",displaySetting);var $cfContent=$(".cf-content");$cfContent.length&&$.each($cfContent,function(index,value){doCommentContent($(this))})}),localforage.getItem("filteredCommenters").then(function(value){filteredCommenters=value||filteredCommenters;var commenterList=new List("cf-commenter-content",{valueNames:["cf-commenter"]}),filteredList=new List("cf-filtered-content",{valueNames:["cf-commenter"]});if(commenterList.remove("cf-commenter",""),filteredList.remove("cf-commenter",""),filteredCommenters&&filteredCommenters.length)for(var i=0;i<filteredCommenters.length;i++)commenterList.remove("cf-commenter",filteredCommenters[i]),filteredList.add({"cf-commenter":filteredCommenters[i]}),hideComments(filteredCommenters[i]);function filterThisCommenter(commenter){filteredCommenters.push(commenter),filteredCommenters=filteredCommenters.filter(makeUnique),localforage.setItem("filteredCommenters",filteredCommenters),filteredList.add({"cf-commenter":commenter}),commenterList.remove("cf-commenter",commenter),hideComments(commenter),doEmptyLists()}function unfilterThisCommenter(commenter){var index=filteredCommenters.indexOf(commenter),$inner;-1!==index&&(filteredCommenters.splice(index,1),localforage.setItem("filteredCommenters",filteredCommenters),filteredList.remove("cf-commenter",commenter),$('.cf-comment-inner[data-name="'+commenter+'"]').length&&commenterList.add({"cf-commenter":commenter}),showComments(commenter),doEmptyLists())}function hideComments(commenter){var $comment=getComment(commenter);$comment.length&&(hideComment($comment),hideReplies($comment))}function hideReplies($comment){$replies=getReplies($comment),$replies.length&&hideComment($replies)}function hideComment($comment){$.each($comment,function(index,value){var $commentLi=$(this).parents(".comment");if(!$(this).hasClass("cf-hidden")){$(this).parents(".comment").addClass("cf-hidden");var $toggle=$(this).find(".cf-toggle");$toggle.length||($toggle=$('<button role="button" class="comment-reply-link cf-toggle">Toggle</button>'),$(this).find(".comment-reply").append($toggle));var $cfContent=$(this).find(".cf-content");$cfContent.length||($cfContent=$('<div class="comment-content cf-content"></div>'),$(this).find(".comment-content").after($cfContent)),$cfContent.length&&doCommentContent($cfContent)}})}function showComments(commenter){var $comment=getComment(commenter);$comment.length&&(showComment($comment),showReplies($comment,commenter))}function showReplies($comment){if($replies=getReplies($comment),$replies.length){var commenter=$replies.data("name"),index;commenter=getEscaped(commenter),-1===filteredCommenters.indexOf(commenter)&&showComment($replies)}}function showComment($comment){var $commentLi=$comment.parent(".comment"),$cfContent=$commentLi.find(".cf-content"),$toggle=$commentLi.find(".cf-toggle");$commentLi.length&&$commentLi.removeClass("cf-hidden cf-hidden-visible"),$cfContent.length&&$cfContent.remove(),$toggle.length&&$toggle.remove()}function getComment(commenter){var $comment=$('.cf-comment-inner[data-name="'+commenter+'"]');return $comment.length?$comment:{}}function getCommentContent($comment){var $content=$comment.find(".comment-content");return $content.length?$content:{}}function getReplies($comment){var id=$comment.data("id");return id?($replies=$('.cf-comment-inner[data-parent="'+id+'"]'),$replies.length?$replies:{}):{}}function doEmptyLists(){bool(commenterList.visibleItems.length&&$commenterContent.hasClass("cf-no-commenters"))?$commenterContent.removeClass("cf-no-commenters"):bool(commenterList.visibleItems.length)||bool($commenterContent.hasClass("cf-no-commenters"))||$commenterContent.addClass("cf-no-commenters"),bool(filteredList.visibleItems.length&&$filteredContent.hasClass("cf-no-commenters"))?$filteredContent.removeClass("cf-no-commenters"):bool(filteredList.visibleItems.length)||bool($filteredContent.hasClass("cf-no-commenters"))||$filteredContent.addClass("cf-no-commenters")}doEmptyLists(),$(".cf-list").on("click",".cf-button",function(e){var commenter=$(this).children(".cf-commenter").text();(commenter=getEscaped(commenter)).length&&($(this).hasClass("cf-add")?filterThisCommenter(commenter):$(this).hasClass("cf-remove")&&unfilterThisCommenter(commenter))}),$(".comment").on("click",".cf-toggle",function(e){var $commentLi=$(this).closest(".comment");$commentLi.length&&$commentLi.toggleClass("cf-hidden-visible")})}))}function doCommentContent($cfContent){$.each($cfContent,function(index,value){switch(displaySetting){case"image":imageIndex===imageCount&&(imageIndex=0),$cfContent.html("<p>"+commentFilterVars.images[imageIndex]+"</p>"),imageIndex++;break;case"quote":quoteIndex===quoteCount&&(quoteIndex=0),$cfContent.html("<p>"+commentFilterVars.quotes[quoteIndex]+"</p>"),quoteIndex++;break;default:$cfContent.html("")}})}function getEscaped(string){var div=document.createElement("div");return div.appendChild(document.createTextNode(string)),div.innerHTML}function makeUnique(value,index,self){return self.indexOf(value)===index}function bool(v){return"false"!==v&&"null"!==v&&"NaN"!==v&&"undefined"!==v&&"0"!==v&&!!v}});